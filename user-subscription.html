<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Chat | Bitforex Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0b1220;
  color:#fff;
  height:100vh;
  overflow:hidden;
}
.topbar{
  background:#020617;
  padding:15px;
  border-bottom:1px solid #1e293b;
}
.chat{
  height:calc(100vh - 130px);
  overflow-y:auto;
  padding:15px;
}
.msg{
  background:#1e293b;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
  max-width:80%;
}
.msg.user{
  background:#22c55e;
  color:#000;
  margin-left:auto;
}
.input-box{
  position:fixed;
  bottom:60px;
  width:100%;
  display:flex;
  gap:5px;
  background:#020617;
  padding:10px;
}
.input-box input{
  flex:1;
  padding:10px;
  border:none;
  border-radius:6px;
}
.input-box button{
  background:#22c55e;
  border:none;
  padding:10px 14px;
  border-radius:6px;
  font-weight:bold;
}
.bottom-nav{
  position:fixed;
  bottom:0;
  width:100%;
  height:60px;
  background:#020617;
  display:flex;
  justify-content:space-around;
  align-items:center;
  border-top:1px solid #1e293b;
}
.bottom-nav a{
  color:#22c55e;
  text-decoration:none;
  text-align:center;
  font-size:12px;
}
</style>
</head>

<body>

<div class="topbar">ğŸ’¬ Chat with Admin</div>

<div class="chat" id="chatBox"></div>

<div class="input-box">
  <button type="button">ğŸ“·</button>
  <input id="messageInput" placeholder="Type message...">
  <button id="sendBtn" type="button">Send</button>
</div>

<div class="bottom-nav">
  <a href="user-chat.html">ğŸ’¬<br>Chat</a>
  <a href="user-subscription.html">ğŸ’³<br>Subs</a>
  <a href="user-courses.html">ğŸ“˜<br>Courses</a>
  <a href="user-settings.html">âš™ï¸<br>Settings</a>
</div>

<!-- Firebase core -->
<script type="module">
import { auth, db } from "./firebase.js";

import { onAuthStateChanged } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
  collection,
  addDoc,
  query,
  orderBy,
  onSnapshot,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const chatBox = document.getElementById("chatBox");
const input = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");

let currentUser = null;

/* AUTH CHECK */
onAuthStateChanged(auth, user=>{
  if(!user){
    location.href="login.html";
    return;
  }
  currentUser = user;
  loadMessages();
});

/* LOAD MESSAGES */
function loadMessages(){
  const q = query(
    collection(db, "messages"),
    orderBy("createdAt","asc")
  );

  onSnapshot(q, snap=>{
    chatBox.innerHTML="";
    snap.forEach(doc=>{
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "msg" + (data.senderId === currentUser.uid ? " user" : "");
      div.textContent = data.text;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    });
  });
}

/* SEND MESSAGE */
sendBtn.onclick = async ()=>{
  const text = input.value.trim();
  if(!text) return;

  await addDoc(collection(db,"messages"),{
    text: text,
    senderId: currentUser.uid,
    createdAt: serverTimestamp()
  });

  input.value="";
};
</script>

</body>
</html>
